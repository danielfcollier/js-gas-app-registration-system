<!DOCTYPE html>

<html lang="en">

<head>
    <base target="_self">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>.nav-link {
            cursor: pointer;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10000;
            width: 100vw;
            height: 100vh;
            background-color: rgba(255, 255, 255, 75%);
        }</style>

    <title>Registration System</title>
</head>

<body>
    <!-- HTML -->

    <h1>Registration System for Ecommerce Store</h1>

    <!-- Customer Button -->
    <button id="customer-button" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" data-bs-whatever="customer">
        Customer Registration
    </button>

    <!-- Product Button -->
    <button id="product-button" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" data-bs-whatever="product">
        Product Registration
    </button>

    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-fullscreen" id="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ol√°</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="container">
                        <nav id="navigation" class="mb-3">
                            <ul class="nav nav-tabs main-nav">
                                <li class="nav-item">
                                    <div class="nav-link" id="add-customer-link">Add Customer
                                </div></li>
                                <li class="nav-item">
                                    <div class="nav-link active" id="search-link">Find Customer</div>
                                </li>
                                <!-- <li class="nav-item">
                                    <div class="nav-link" id="add-product-link">Add Product</a>
                                </li> -->
                                <!-- <li class="nav-item">
                                    <div class="nav-link active" id="product-search-link">Find Product</div></a>
                                </li> -->
                            </ul>
                        </nav>
                    </div>

                    <div id="app"> </div>

                    <div id="loading" class="d-flex justify-content-center align-items-center invisible">
                        <div class="spinner-grow" style="width: 3rem; height: 3rem;" role="status">
                            <span class="sr-only"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->

    <script>var modal = document.getElementById('modal');
var customerButton = document.getElementById('customer-button');
var productButton = document.getElementById('product-button');
modal.addEventListener('shown.bs.modal', function (event) {
  // customerButton.focus();
  // productButton.focus();
  var recipient = event.relatedTarget.getAttribute('data-bs-whatever');
  var modalTitle = modal.querySelector('.modal-title');
  modalTitle.textContent = 'New message to ' + recipient;
});
localStorage.setItem("0002", "fajfksjadfklajf");</script>

    <script>// modules are defined as an array
// [ module function, map of requires ]
//
// map of requires is short require name -> numeric require
//
// anything defined in a previous bundle is accessed via the
// orig method which is the require for previous bundles
parcelRequire = (function (modules, cache, entry, globalName) {
  // Save the require from previous bundle to this closure if any
  var previousRequire = typeof parcelRequire === 'function' && parcelRequire;
  var nodeRequire = typeof require === 'function' && require;

  function newRequire(name, jumped) {
    if (!cache[name]) {
      if (!modules[name]) {
        // if we cannot find the module within our internal map or
        // cache jump to the current global require ie. the last bundle
        // that was added to the page.
        var currentRequire = typeof parcelRequire === 'function' && parcelRequire;
        if (!jumped && currentRequire) {
          return currentRequire(name, true);
        }

        // If there are other bundles on this page the require from the
        // previous one is saved to 'previousRequire'. Repeat this as
        // many times as there are bundles until the module is found or
        // we exhaust the require chain.
        if (previousRequire) {
          return previousRequire(name, true);
        }

        // Try the node require function if it exists.
        if (nodeRequire && typeof name === 'string') {
          return nodeRequire(name);
        }

        var err = new Error('Cannot find module \'' + name + '\'');
        err.code = 'MODULE_NOT_FOUND';
        throw err;
      }

      localRequire.resolve = resolve;
      localRequire.cache = {};

      var module = cache[name] = new newRequire.Module(name);

      modules[name][0].call(module.exports, localRequire, module, module.exports, this);
    }

    return cache[name].exports;

    function localRequire(x){
      return newRequire(localRequire.resolve(x));
    }

    function resolve(x){
      return modules[name][1][x] || x;
    }
  }

  function Module(moduleName) {
    this.id = moduleName;
    this.bundle = newRequire;
    this.exports = {};
  }

  newRequire.isParcelRequire = true;
  newRequire.Module = Module;
  newRequire.modules = modules;
  newRequire.cache = cache;
  newRequire.parent = previousRequire;
  newRequire.register = function (id, exports) {
    modules[id] = [function (require, module) {
      module.exports = exports;
    }, {}];
  };

  var error;
  for (var i = 0; i < entry.length; i++) {
    try {
      newRequire(entry[i]);
    } catch (e) {
      // Save first error but execute all entries
      if (!error) {
        error = e;
      }
    }
  }

  if (entry.length) {
    // Expose entry point to Node, AMD or browser globals
    // Based on https://github.com/ForbesLindesay/umd/blob/master/template.js
    var mainExports = newRequire(entry[entry.length - 1]);

    // CommonJS
    if (typeof exports === "object" && typeof module !== "undefined") {
      module.exports = mainExports;

    // RequireJS
    } else if (typeof define === "function" && define.amd) {
     define(function () {
       return mainExports;
     });

    // <script>
    } else if (globalName) {
      this[globalName] = mainExports;
    }
  }

  // Override the current require with this new one
  parcelRequire = newRequire;

  if (error) {
    // throw error from earlier, _after updating parcelRequire_
    throw error;
  }

  return newRequire;
})({"oMsD":[function(require,module,exports) {
var customerData;

function loadView(options) {
  var id = options.id || "app";

  var callback = options.callback || function () {};

  loadingStart();
  google.script.run.withSuccessHandler(function (html) {
    document.getElementById(id).innerHTML = html;
    loadingEnd();
    callback(options.params || null);
  })[options.func]();
}

function setDataForSearch() {
  loadingStart();
  google.script.run.withSuccessHandler(function (dataReturned) {
    customerData = dataReturned.slice();
    loadingEnd();
  }).getDataForSearch();
}

function search() {
  var searchInput = document.getElementById("search-input").value.toString().toLowerCase().trim();
  var searchWords = searchInput.split(/\s+/);
  var searchColumns = [1, 2];
  var searchResults = searchInput === "" ? [] : customerData.filter(function (r) {
    return searchWords.every(function (word) {
      return searchColumns.some(function (colIndex) {
        return r[colIndex].toString().toLowerCase().indexOf(word) !== -1;
      });
    });
  }); //document.getElementById("search-counter").textContent = "0";

  var searchResultsBox = document.getElementById("search-results");
  var templateBox = document.getElementById("row-template");
  var template = templateBox.content;
  searchResultsBox.innerHTML = "";
  searchResults.forEach(function (r) {
    var row = template.cloneNode(true);
    var customerIdColumn = row.querySelector(".customerId");
    var firstNameColumn = row.querySelector(".firstName");
    var lastNameColumn = row.querySelector(".lastName");
    var deleteButton = row.querySelector(".delete-button");
    var editButton = row.querySelector(".edit-button");
    customerIdColumn.textContent = r[0];
    deleteButton.dataset.customerId = r[0];
    editButton.dataset.customerId = r[0];
    firstNameColumn.textContent = r[1];
    lastNameColumn.textContent = r[2];
    searchResultsBox.appendChild(row);
  });
}

function displayConfirmationDelete(event) {
  if (event.target.dataset.buttonState === "delete") {
    event.target.previousElementSibling.classList.remove("d-none");
    event.target.textContent = "Cancel";
    event.target.dataset.buttonState = "cancel";
  } else {
    event.target.previousElementSibling.classList.add("d-none");
    event.target.textContent = "Delete";
    event.target.dataset.buttonState = "delete";
  }
}

function deleteCustomer(event) {
  var custId = event.target.dataset.customerId.toString().toLowerCase();
  loadingStart();
  google.script.run.withSuccessHandler(function () {
    event.target.closest(".result-box").remove();
    var ids = customerData.map(function (r) {
      return r[0].toString().toLowerCase();
    });
    var index = ids.indexOf(custId);
    customerData.splice(index, 1);
    loadingEnd();
  }).deleteById(custId);
}

function afterEditViewLoads(params) {
  // custId: event.target.dataset.customerId
  loadingStart();
  document.getElementById("customer-id").value = params.custId;
  google.script.run.withSuccessHandler(function (customerInfo) {
    document.getElementById("first-name").value = customerInfo.firstName;
    document.getElementById("last-name").value = customerInfo.lastName;
    document.getElementById("phone-number").value = customerInfo.phoneNumber;
    loadingEnd();
  }).getCustomerById(params.custId);
}

function editCustomer() {
  var customerInfo = {};
  customerInfo.id = document.getElementById("customer-id").value;
  customerInfo.firstName = document.getElementById("first-name").value;
  customerInfo.lastName = document.getElementById("last-name").value;
  customerInfo.phoneNumber = document.getElementById("phone-number").value;
  loadingStart();
  google.script.run.withSuccessHandler(function (result) {
    document.getElementById("save-success-alert").classList.remove("invisible");
    setTimeout(function () {
      document.getElementById("save-success-alert").classList.add("invisible");
      document.getElementById("first-name").value = "";
      document.getElementById("last-name").value = "";
      document.getElementById("phone-number").value = "";
      loadingEnd();
      loadSearchView();
    }, 4000);
  }).editCustomerById(customerInfo);
}

function addCustomer() {
  var customerInfo = {};
  customerInfo.firstName = document.getElementById("first-name").value;
  customerInfo.lastName = document.getElementById("last-name").value;
  customerInfo.phoneNumber = document.getElementById("phone-number").value;
  loadingStart();
  google.script.run.withSuccessHandler(function () {
    document.getElementById("first-name").value = "";
    document.getElementById("last-name").value = "";
    document.getElementById("phone-number").value = "";
    document.getElementById("save-success-alert").classList.remove("invisible");
    setTimeout(function () {
      document.getElementById("save-success-alert").classList.add("invisible");
    }, 4000);
    loadingEnd();
  }).addCustomer(customerInfo);
}

function loadSearchView() {
  loadView({
    func: "loadSearchView",
    callback: setDataForSearch
  });
}

function loadAddCustomerView() {
  loadView({
    func: "loadAddCustomerView"
  });
}

function loadEditCustomerView(event) {
  loadView({
    func: "loadEditCustomerView",
    callback: afterEditViewLoads,
    params: {
      custId: event.target.dataset.customerId
    }
  });
}

function activeTabChange(event) {
  var navLinks = document.querySelectorAll(".main-nav .nav-link");
  navLinks.forEach(function (linkElement) {
    linkElement.classList.remove("active");
  });
  event.target.classList.add("active");
}

function loadingStart() {
  document.getElementById("loading").classList.remove("invisible");
}

function loadingEnd() {
  document.getElementById("loading").classList.add("invisible");
}

document.getElementById("search-link").addEventListener("click", loadSearchView);
document.getElementById("add-customer-link").addEventListener("click", loadAddCustomerView);

function inputEventHandler(event) {
  if (event.target.matches("#search-input")) {
    search();
  }
}

function clickEventHandler(event) {
  if (event.target.matches(".delete-button")) {
    deleteCustomer(event);
  }

  if (event.target.matches(".before-delete-button")) {
    displayConfirmationDelete(event);
  }

  if (event.target.matches(".edit-button")) {
    loadEditCustomerView(event);
  }

  if (event.target.matches("#save-changes")) {
    editCustomer();
  }

  if (event.target.matches("#cancel-changes")) {
    loadSearchView();
  }

  if (event.target.matches("#add-customer-button")) {
    addCustomer();
  }
}

function navClickEventHandler(event) {
  if (event.target.matches(".nav-link")) {
    activeTabChange(event);
  }
}

document.getElementById("app").addEventListener("input", inputEventHandler);
document.getElementById("app").addEventListener("click", clickEventHandler);
document.getElementById("navigation").addEventListener("click", navClickEventHandler);
document.addEventListener("DOMContentLoaded", loadSearchView);
},{}]},{},["oMsD"], null)</script>
    <script>// modules are defined as an array
// [ module function, map of requires ]
//
// map of requires is short require name -> numeric require
//
// anything defined in a previous bundle is accessed via the
// orig method which is the require for previous bundles
parcelRequire = (function (modules, cache, entry, globalName) {
  // Save the require from previous bundle to this closure if any
  var previousRequire = typeof parcelRequire === 'function' && parcelRequire;
  var nodeRequire = typeof require === 'function' && require;

  function newRequire(name, jumped) {
    if (!cache[name]) {
      if (!modules[name]) {
        // if we cannot find the module within our internal map or
        // cache jump to the current global require ie. the last bundle
        // that was added to the page.
        var currentRequire = typeof parcelRequire === 'function' && parcelRequire;
        if (!jumped && currentRequire) {
          return currentRequire(name, true);
        }

        // If there are other bundles on this page the require from the
        // previous one is saved to 'previousRequire'. Repeat this as
        // many times as there are bundles until the module is found or
        // we exhaust the require chain.
        if (previousRequire) {
          return previousRequire(name, true);
        }

        // Try the node require function if it exists.
        if (nodeRequire && typeof name === 'string') {
          return nodeRequire(name);
        }

        var err = new Error('Cannot find module \'' + name + '\'');
        err.code = 'MODULE_NOT_FOUND';
        throw err;
      }

      localRequire.resolve = resolve;
      localRequire.cache = {};

      var module = cache[name] = new newRequire.Module(name);

      modules[name][0].call(module.exports, localRequire, module, module.exports, this);
    }

    return cache[name].exports;

    function localRequire(x){
      return newRequire(localRequire.resolve(x));
    }

    function resolve(x){
      return modules[name][1][x] || x;
    }
  }

  function Module(moduleName) {
    this.id = moduleName;
    this.bundle = newRequire;
    this.exports = {};
  }

  newRequire.isParcelRequire = true;
  newRequire.Module = Module;
  newRequire.modules = modules;
  newRequire.cache = cache;
  newRequire.parent = previousRequire;
  newRequire.register = function (id, exports) {
    modules[id] = [function (require, module) {
      module.exports = exports;
    }, {}];
  };

  var error;
  for (var i = 0; i < entry.length; i++) {
    try {
      newRequire(entry[i]);
    } catch (e) {
      // Save first error but execute all entries
      if (!error) {
        error = e;
      }
    }
  }

  if (entry.length) {
    // Expose entry point to Node, AMD or browser globals
    // Based on https://github.com/ForbesLindesay/umd/blob/master/template.js
    var mainExports = newRequire(entry[entry.length - 1]);

    // CommonJS
    if (typeof exports === "object" && typeof module !== "undefined") {
      module.exports = mainExports;

    // RequireJS
    } else if (typeof define === "function" && define.amd) {
     define(function () {
       return mainExports;
     });

    // <script>
    } else if (globalName) {
      this[globalName] = mainExports;
    }
  }

  // Override the current require with this new one
  parcelRequire = newRequire;

  if (error) {
    // throw error from earlier, _after updating parcelRequire_
    throw error;
  }

  return newRequire;
})({"JJoR":[function(require,module,exports) {

},{}]},{},["JJoR"], null)</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>

</html>